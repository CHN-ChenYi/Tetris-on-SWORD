# Top 模块

## 输入输出

### 输入

* 键盘输入
  * 允许 `WASD`，`HJKL`（参考 Vim）和方向键的上下左右
    * “上”表示方块顺时针旋转
    * “下”表示方块逆时针旋转
    * “左”表示方块向左平移
    * “右”表示方块向右平移
  * `Escape` 键表示重新开始游戏
* 开关输入
  * 从 `SW[0]` 到 `SW[3]` 一共四个速度选择开关，其中 `SW[3]` 为速度最快的，若有速度快的开关和速度慢的开关同时为 1 的话，采取快的那个速度

### 输出

* VGA 输出：显示当前游戏状态
* 八位七段数码管输出：`SCOREXXX`，其中 `XXX` 为玩家当前分数

## 逻辑

### 逻辑
![](img/top-Page-1.svg)

### 状态

俄罗斯方块游戏的游戏状态被定义为了 5 个子状态：
* `static`: 当前已经静止的方块的状态，由一个 200 位的数表示，从左下角 0 开始先向右再向上编号，即右下角的块的编号为 9，右上角为 199。对应编号的位若为 0 则表示那里没有方块
* `float`: 当前仍在浮动的方块的状态，用一个 16 位数表示，与 `static` 的编号方式类似，下面给出 7 种俄罗斯方块的初始状态
  * 1 型
    ```
    0100
    0100
    0100
    0100
    ```
  * J 型
    ```
    0000
    0100
    0111
    0000
    ```
  * L 型
    ```
    0000
    0010
    1110
    0000
    ```
  * S 型
    ```
    0000
    0110
    1100
    0000
    ```
  * Z 型
    ```
    0000
    1100
    0110
    0000
    ```
  * T 型
    ```
    0000
    0100
    1110
    0000
    ```
  * O 型
    ```
    0000
    0110
    0110
    0000
    ```
* `pos_x` 与 `pos_y`: 浮动的方块的 4*4 矩形的右上角的方块在静止游戏局面的坐标，以右上角为锚点是为了防止负数的出现
* `game_status`: 当前游戏的状态，0 表示游戏正在进行中，1 表示游戏已经结束

### 状态转移
![](img/top-Page-2.svg)
![](img/top-Page-final.svg)
